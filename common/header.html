<script defer src="https://unpkg.com/img-comparison-slider@7/dist/index.js"></script>
<link rel="stylesheet" href="https://unpkg.com/img-comparison-slider@7/dist/styles.css" />
<script type="text/discourse-plugin" version="0.0.1">

  function extractImages(html){
  const imgs = html.querySelectorAll("img");
  var length = [...imgs].length;
  if (length > 0){
    return [imgs[0].src, imgs[1].src];
  } else {
    return ["No image found", "No image found"]
  }
}

function stackImages(imgs){
  console.log(imgs[0]);
  var left = ["<img slot='first' src='", imgs[0], "'/>"].join('');
  var right = ["<img slot='second' src='", imgs[1], "'/>"].join('');
  var direction = settings.default_direction;
  return ["<img-comparison-slider class = 'colored-slider' direction = '", direction,"'>", left, right, "</img-comparison-slider>"].join('')
}


  function componentPrep(cooked)
  {
    cooked.querySelectorAll('div[data-image-comparison-slider]').forEach(slider => {
      let imgs = extractImages(slider);
      let finalHTML = stackImages(imgs);
      slider.innerHTML = finalHTML;
    })
  }


    let translations = I18n.translations[I18n.currentLocale()].js;

    if (!translations) {
      translations = {};
    }
    if (!translations.composer) {
      translations.composer = {};
    }
    translations.button_text = settings.button_text;
    translations.composer.add_images_prompt =
      settings.add_images_prompt;


    api.decorateCookedElement(componentPrep, {
        onlyStream: false, 
        id: 'image-comparison-slider'
      });


    api.onToolbarCreate(function(toolbar){
        toolbar.addButton({
            trimLeading: true,
            id: "image-comparison-slider",
            group: "insertions",
            icon: "bolt",
            title: "image-comparison-slider",
            perform: e => e.applySurround(
                "<div data-image-comparison-slider>\n\n",
                "\n\n</div>",
                "add_images_prompt",
                { multiline: false }
            )
        });
    });
</script>